<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Python IDE – NumPy & Pandas ready</title>

    <!-- CodeMirror core & Python mode -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>

    <!-- Optional: CodeMirror dark theme -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css"
    />

    <!-- Pyodide (Python‑in‑Wasm) -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.7/full/pyodide.js"></script>

    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 0;
        padding: 1rem;
        background: #f5f5f5;
      }
      h1 {
        font-size: 1.4rem;
        margin-bottom: 0.5rem;
      }
      #editor-wrapper {
        border: 1px solid #ccc;
        border-radius: 8px;
        overflow: hidden;
      }
      #editor {
        height: 320px;
      }
      #run {
        margin-top: 0.75rem;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #0070f3;
        color: #ffffff;
      }
      #output {
        margin-top: 1rem;
        padding: 1rem;
        background: #1e1e1e;
        color: #ffffff;
        min-height: 140px;
        white-space: pre-wrap;
        border-radius: 6px;
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
      }
    </style>
  </head>
  <body>
    <h1>Mini Python IDE <small>(NumPy & Pandas ready)</small></h1>

    <div id="editor-wrapper">
      <textarea id="editor"></textarea>
    </div>

    <button id="run">Run ▶</button>

    <h2>Output</h2>
    <div id="output"></div>

    <script>
      ////////////////////////////////////////////////////////////////
      // 1️⃣ Initialize CodeMirror
      ////////////////////////////////////////////////////////////////
      const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: "python",
        theme: "monokai",
        lineNumbers: true,
        indentUnit: 4,
        tabSize: 4,
        autofocus: true,
      });

      // Default snippet that demonstrates pandas
      editor.setValue(`import pandas as pd\nimport numpy as np\n\n# Create a tiny DataFrame\ndf = pd.DataFrame({\n    "A": np.arange(1, 6),\n    "B": np.random.randn(5),\n})\nprint(df)\n`);

      ////////////////////////////////////////////////////////////////
      // 2️⃣ Capture stdout / stderr to the #output div
      ////////////////////////////////////////////////////////////////
      const outputEl = document.getElementById("output");
      function write(...args) {
        outputEl.textContent += args.join(" ") + "\n";
      }

      ////////////////////////////////////////////////////////////////
      // 3️⃣ Load Pyodide *and* the extra Python packages only once
      ////////////////////////////////////////////////////////////////
      const pyodideReady = (async () => {
        write("⌛ Downloading Python runtime & packages (numpy, pandas)…");
        const py = await loadPyodide({ stdout: write, stderr: write });

        // Load scientific packages – first run only (cached afterwards)
        await py.loadPackage(["numpy", "pandas"]);
        write("✅ NumPy & Pandas are ready!\n———————");
        return py;
      })();

      ////////////////////////////////////////////////////////////////
      // 4️⃣ Run button handler
      ////////////////////////////////////////////////////////////////
      document.getElementById("run").addEventListener("click", async () => {
        const py = await pyodideReady; // ensure runtime & packages loaded
        outputEl.textContent = ""; // clear previous output
        try {
          const result = await py.runPythonAsync(editor.getValue());
          if (result !== undefined) {
            write(result);
          }
        } catch (err) {
          write(err);
        }
      });
    </script>
  </body>
</html>
